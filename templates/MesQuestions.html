{% extends "base.html" %}

{% block title %}Mes questions{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename = 'mesQuestions.css') }}">

<!-- Barre de navigation Boostrap pour trier les questions ou en creer une nouvelle -->
<nav class="navbar navbar-expand-sm navbar-dark" id="navQuestions" style="background-color:rgb(169, 177, 177)">
  <div class="container-fluid">
    <!-- Boutton menu dépliant pour les plus petits écrans -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar2"
      style="background-color : #212529;">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-center" id="collapsibleNavbar2">
      <ul class="navbar-nav">
        <li class="nav-item">
          <form action="" method="GET" id="tagForm">
            <!-- Dropdown Boostrap avec tous les tags utilisés sur la page courante -->
            <div class="dropdown">
              <button type="button" class="btn btn-primary dropdown-toggle itemBut" data-bs-toggle="dropdown">
                Tags
              </button>

              <ul class="dropdown-menu overflow-auto" id="tagList">
                {%for t in tags%}
                <li><label for="{{t}}"><input type="checkbox" name="{{t}}" class="tagCheck">{{t}}</label></li>
                {%endfor%}
              </ul>

            </div>
          </form>
        </li>
        <li class="nav-item">
          <button type="button" class="btn btn-primary itemBut" onclick="filterByTags()">Filtrer par tag</button>
        </li>


        <li class="nav-item">
          <a class="btn btn-primary itemBut" href="{{url_for('editeur.init', questionId='createNew')}}">Creer une question</a>
        </li>
        <li class="nav-item">
          <button type="button" class="btn btn-primary itemBut" onclick="submitForm('/MesQuestions/Sorting')">Ordonner la sélection</button>
        </li>
        <li class="nav-item">
          <button type="button" class="btn btn-danger itemBut" onclick="submitForm('/MesQuestions/Delete')">Supprimer la sélection</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Flexbox Boostrap pour que tous les éléments se replacent en fonction de la taille de l'écran-->
<!-- Ceci dans un formulaire qui nous permetteras de selectionner les questions pour générer une page de qcm-->

<button data-bs-toggle="collapse" data-bs-target="#questionsCollapse" class="collapseBut"><h3>Réponses ⌄</h3></button>

<div id="questionsCollapse" class="collapse show">
  <form id="questionsForm" action="/MesQuestions/Sorting" method="POST">
    <div class="d-flex flex-wrap justify-content-around" style="margin-top: 20px;" id="questionCards">
      <!-- Card Boostrap car cela rendais bien pour un bref apercu -->
      {%for q in questions%}
      <div class="card questionCard">
        <div class="card-header">
          <input type="checkbox" name="{{q['id']}}" class="checkBoxQuestion">
          <a href="{{url_for('editeur.init', questionId=q['id'])}}" class="link-dark">{{q['title']}}</a>
        </div>
        <div class="card-body">{{q['state']|safe}}</div>
        <div class="card-footer" style="color:blue">{%for t in q['tags']%}{{t}};{%endfor%}</div>
      </div>

      {%endfor%}
    </div>
  </form>
</div>

<button data-bs-toggle="collapse" data-bs-target="#sequencesCollapse" class="collapseBut"><h3>Séquences ⌄</h3></button>

<div id="sequencesCollapse" class="collapse show">
  <form id="sequencesForm" action="" method="POST">
    <div class="d-flex flex-wrap justify-content-around" style="margin-top: 20px;" id="questionCards">
      <!-- Card Boostrap car cela rendais bien pour un bref apercu -->
      {%for s in sequences%}
      <div class="card questionCard">
        <div class="card-header">
          <input type="checkbox" name="{{s['id']}}" class="checkBoxQuestion">
          {{s['title']}}
        </div>
        <div class="card-body"><ul>{% for t in s['questionTitles'] %}<li>{{t}}</li>{%endfor%}</ul></div>
        <div class="card-footer" style="color:blue">tags quand yen auras</div>
      </div>

      {%endfor%}
    </div>
  </form>
</div>

<script>
  function filterByTags() {

    questions = $("#questionCards").find(".questionCard");
    allTags = $("#tagList").find(".tagCheck");
    selectedTags = [];

    // récupération des tags cochés
    allTags.each(function () {
      if (this.checked) {
        selectedTags.push(this.name);
      }
    });

    // si aucun montrer toutes les questions
    if (selectedTags.length == 0) {
      questions.each(function () {
        this.setAttribute("style", "");
      });
    }
    // sinon on verifie si le tag appartient à la question grace à la chaine de charactères
    else {
      console.log(selectedTags)
      questions.each(function () {
        q = $(this)
        tags = q.find(".card-footer").text().split(";");
        hasTag = false
        for (let i = 0; i < tags.length - 1; i++) {
          if (selectedTags.includes(tags[i])) {
            hasTag = true;
          }
        }
        if (!hasTag) {
          this.setAttribute("style", "display : none");
        }
        else {
          this.setAttribute("style", "");
        }
      })
    }
  }

  function submitForm(destination){
    let form = document.getElementById("questionsForm");
    form.action = destination;
    form.submit()
  }

</script>

{% endblock %}